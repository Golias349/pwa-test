<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gr√£o Digital</title>
  <meta name="theme-color" content="#16a34a">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icone-192.png">
  <style>
    :root {
      --bg:#0b1215;
      --card:#0f1820;
      --muted:#9fb0b7;
      --text:#e6f4ef;
      --accent:#22c55e;
      --accent-600:#16a34a;
      --accent-700:#15803d;
      --danger:#ef4444;
      --ring: 0 0 0 2px rgba(34,197,94,.35);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:500 16px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial;}
    header{background: linear-gradient(180deg,#16a34a,#0ea25a 55%, #0b1215 100%); padding:28px 16px 40px; text-align:center; position:sticky; top:0; z-index:5; box-shadow:var(--shadow)}
    header h1{margin:8px 0 6px; font-weight:800; letter-spacing:.4px; font-size: clamp(26px,3vw,32px)}
    header small{opacity:.9}
    main{max-width:1100px;margin:-28px auto 120px;padding:0 16px}
    .card{background:var(--card); border:1px solid #1b2a34; border-radius:var(--radius); box-shadow:var(--shadow); padding:18px 18px 14px; margin:22px 0}
    .card h2{display:flex;gap:10px;align-items:center; font-size:20px; margin:0 0 12px}
    .row{display:grid;gap:12px; grid-template-columns:repeat(12,1fr); align-items:center}
    .row>.col-3{grid-column:span 3}
    .row>.col-4{grid-column:span 4}
    .row>.col-6{grid-column:span 6}
    .row>.col-8{grid-column:span 8}
    .row>.col-12{grid-column:span 12}
    @media(max-width:900px){
      .row{grid-template-columns:repeat(6,1fr)}
      .row>[class*='col-']{grid-column:span 6}
    }
    label{display:block; margin:8px 0 6px; color:var(--muted); font-size:.92rem}
    input, select, textarea, button{width:100%; border-radius:12px; border:1px solid #1c2a34; background:#0c151a; color:var(--text); padding:12px 14px; outline:none; transition:.2s}
    input:focus, select:focus, textarea:focus{box-shadow:var(--ring); border-color:#255c44}
    textarea{min-height:46px; resize:vertical}
    .btn{background:var(--accent); border:none; color:#042312; font-weight:700; letter-spacing:.3px; cursor:pointer}
    .btn:hover{background:var(--accent-600)}
    .btn-outline{background:transparent; border:1px solid #254235; color:#d6ffe7}
    .btn-outline:hover{background:#0f1f18}
    .btn-danger{background:var(--danger); color:#2b0a0a}
    .muted{color:var(--muted); font-size:.9rem}
    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px; border:1px solid #23323b}
    th,td{padding:12px 14px; border-bottom:1px solid #23323b}
    th{background:#0f1a20; text-align:left}
    tfoot td{font-weight:700}
    .grid-2{display:grid; gap:16px; grid-template-columns:1fr 1fr}
    @media(max-width:900px){.grid-2{grid-template-columns:1fr}}
    nav{position:fixed; bottom:10px; left:0; right:0; display:flex; justify-content:center; z-index:10}
    .tabs{display:grid; grid-template-columns:repeat(5, minmax(0,240px)); gap:12px; width:min(1100px,95vw)}
    .tab{background:#0d171b; border:1px solid #1c2a34; color:#bfead4; padding:12px 16px; text-align:center; border-radius:14px; cursor:pointer; font-weight:700}
    .tab.active{background:var(--accent-600); color:#042312; border-color:#1b6d45}
    .right{display:flex; gap:8px; justify-content:flex-end}
    .pill{display:inline-flex; padding:6px 10px; background:#0d171b; border:1px solid #24363f; color:#b9d5c7; border-radius:999px; gap:8px; align-items:center; font-size:.86rem}
    .kpi{display:flex; gap:10px; align-items:center; padding:10px 12px; background:#0e181d; border:1px solid #21333d; border-radius:12px}
    canvas{background:#0a1116; border:1px solid #192932; border-radius:12px}
    footer{height:50px}
  </style>
  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <header>
    <div class="pill" style="margin:auto; width:max-content">
      <span style="font-size:22px">üå±</span> <b>Gr√£o Digital</b>
    </div>
    <h1 id="titulo">Gr√£o Digital</h1>
    <small id="dataHoje"></small>
  </header>

  <main>
    <!-- Talh√µes -->
    <section id="sec-talhoes" class="card">
      <h2>üåæ Talh√µes</h2>
      <div class="row">
        <div class="col-8">
          <label for="nomeTalhao">Nome do Talh√£o</label>
          <input id="nomeTalhao" placeholder="Ex.: Clonal 01">
        </div>
        <div class="col-4" style="margin-top:28px">
          <button class="btn" onclick="adicionarTalhao()">Adicionar Talh√£o</button>
        </div>
      </div>
      <div id="listaTalhoes" class="row" style="margin-top:12px; grid-template-columns:repeat(3,1fr)"></div>
    </section>

    <!-- Registros -->
    <section id="sec-registros" class="card" style="display:none">
      <h2>üìù Registros de Aduba√ß√£o</h2>
      <div class="row">
        <div class="col-3">
          <label>Talh√£o</label>
          <select id="selTalhao"></select>
        </div>
        <div class="col-4">
          <label>Insumo (do estoque)</label>
          <select id="selInsumo"></select>
          <div class="muted" id="helpInsumo">O custo usa o pre√ßo do estoque (saco 50kg).</div>
        </div>
        <div class="col-3">
          <label>Qtde aplicada (kg)</label>
          <input id="qtdAplicada" type="number" step="0.1" placeholder="Ex.: 500">
        </div>
        <div class="col-12">
          <label>Descri√ß√£o (opcional)</label>
          <input id="descAplicacao" placeholder="Ex.: Cobertura...">
        </div>
        <div class="col-12 right">
          <button class="btn" onclick="salvarAplicacao()">Salvar aplica√ß√£o</button>
        </div>
      </div>

      <h3 style="margin-top:16px">√öltimas aplica√ß√µes</h3>
      <div id="listaAplicacoes" class="row col-12"></div>
    </section>

    <!-- Estoque -->
    <section id="sec-estoque" class="card" style="display:none">
      <h2>üì¶ Estoque</h2>
      <div class="row">
        <div class="col-4">
          <label>Nome do insumo</label>
          <input id="nomeInsumo" placeholder="Ex.: NPK">
        </div>
        <div class="col-4">
          <label>Quantidade (kg)</label>
          <input id="qtdInsumo" type="number" step="0.1" placeholder="Ex.: 1000">
        </div>
        <div class="col-4">
          <label>Pre√ßo por saco (50kg)</label>
          <input id="precoSaco" type="number" step="0.01" placeholder="Ex.: 120">
        </div>
        <div class="col-12 right">
          <button class="btn" onclick="addEstoque()">Adicionar ao Estoque</button>
        </div>
      </div>

      <h3 style="margin-top:16px">Itens</h3>
      <table>
        <thead><tr><th>Insumo</th><th>Quantidade (kg)</th><th>Pre√ßo 50kg (R$)</th><th></th></tr></thead>
        <tbody id="tbodyEstoque"></tbody>
      </table>

      <h3 style="margin-top:16px">Resumo Mensal (tabela)</h3>
      <div class="row">
        <div class="col-3">
          <label>M√™s</label>
          <select id="mm"></select>
        </div>
        <div class="col-3">
          <label>Ano</label>
          <select id="yy"></select>
        </div>
        <div class="col-6" style="margin-top:28px" class="right">
          <button class="btn-outline" onclick="exportarCSV()">Exportar CSV</button>
          <button class="btn-outline" onclick="exportarPDF()">Exportar PDF</button>
        </div>
      </div>
      <table style="margin-top:10px">
        <thead><tr><th>Insumo</th><th>Kg aplicados</th><th>Gasto (R$)</th><th>M√™s/Ano</th></tr></thead>
        <tbody id="tbodyResumo"></tbody>
        <tfoot><tr><td>Total</td><td id="totKg">0</td><td id="totR$">0,00</td><td id="totMes"></td></tr></tfoot>
      </table>
    </section>

    <!-- Resumo (gr√°ficos) -->
    <section id="sec-resumo" class="card" style="display:none">
      <h2>üìä Resumo ‚Äî gr√°ficos</h2>
      <div class="grid-2">
        <div>
          <h3 style="margin:8px 0">Kg aplicados por insumo</h3>
          <canvas id="chartKg" height="220"></canvas>
        </div>
        <div>
          <h3 style="margin:8px 0">Gasto por insumo (R$)</h3>
          <canvas id="chartR$" height="220"></canvas>
        </div>
      </div>
    </section>

    <!-- Hist√≥rico (CSV/PDF de todos os registros) -->
    <section id="sec-historico" class="card" style="display:none">
      <h2>üóÇÔ∏è Hist√≥rico</h2>
      <div class="right" style="margin-bottom:10px">
        <button class="btn-outline" onclick="exportarCSV(true)">Exportar CSV</button>
        <button class="btn-outline" onclick="exportarPDF(true)">Exportar PDF</button>
      </div>
      <table>
        <thead><tr><th>Data</th><th>Talh√£o</th><th>Insumo</th><th>Kg</th><th>Custo (R$)</th><th>Descri√ß√£o</th></tr></thead>
        <tbody id="tbodyHistorico"></tbody>
      </table>
    </section>

    <!-- Config -->
    <section id="sec-config" class="card" style="display:none">
      <h2>‚öôÔ∏è Configura√ß√µes</h2>
      <div class="card">
        <h3>Backup (JSON)</h3>
        <div class="right">
          <button class="btn-outline" onclick="exportarBackup()">Exportar backup (JSON)</button>
          <input type="file" id="inputRestore" style="display:none" accept="application/json" />
          <button class="btn-outline" onclick="document.getElementById('inputRestore').click()">Importar backup (JSON)</button>
        </div>
      </div>
      <div class="card">
        <h3>Backup no Google Drive (opcional)</h3>
        <p class="muted">Use sua conta Google para salvar e carregar o backup. (escopo drive.file)</p>
        <div class="right">
          <button class="btn-outline" onclick="conectarGoogle()">Conectar ao Google</button>
          <button class="btn-outline" onclick="salvarNoDrive()">Salvar no Drive</button>
          <button class="btn-outline" onclick="carregarDoDrive()">Carregar do Drive</button>
        </div>
      </div>
      <div class="card">
        <h3>Limpeza</h3>
        <button class="btn-danger" onclick="apagarTudo()">Apagar TODOS os dados</button>
      </div>
    </section>
  </main>

  <nav>
    <div class="tabs">
      <div class="tab active" onclick="show('talhoes')">üåæ Talh√µes</div>
      <div class="tab" onclick="show('registros')">üìù Registros</div>
      <div class="tab" onclick="show('estoque')">üì¶ Estoque</div>
      <div class="tab" onclick="show('resumo')">üìä Resumo</div>
      <div class="tab" onclick="show('historico')">üóÇÔ∏è Hist√≥rico</div>
      <div class="tab" onclick="show('config')">‚öôÔ∏è Config</div>
    </div>
  </nav>
  <footer></footer>

  <script src="app.js"></script>
</body>
</html>
