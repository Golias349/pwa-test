<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>🌱 Grão Digital</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icone.png">
  <link rel="apple-touch-icon" href="icone-192.png">
  <meta name="theme-color" content="#1e7f3f">
  <link rel="stylesheet" href="estilo.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- jsPDF + autotable -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo">🌱</span>
      <div>
        <h1>Grão Digital</h1>
        <small id="subtitle">Gestão de talhões, aplicações e custos</small>
      </div>
    </div>
  </header>

  <main id="content">
    <!-- Talhões -->
    <section id="sec-talhoes" class="card active">
      <h2>🌿 Talhões</h2>
      <div class="row">
        <input id="inpTalhao" placeholder="Nome do Talhão"/>
        <button class="btn" id="btnAddTalhao">Adicionar Talhão</button>
      </div>
      <ul id="listaTalhoes" class="list"></ul>
    </section>

    <!-- Registros -->
    <section id="sec-registros" class="card">
      <h2>🧾 Registros de Adubação</h2>
      <div class="grid-4">
        <select id="selTalhao"></select>
        <select id="selInsumo"></select>
        <input id="inpDesc" placeholder="Descrição (opcional)"/>
        <input id="inpQtd" type="number" step="0.01" placeholder="Qtde aplicada (kg)"/>
      </div>
      <div class="hint" id="insumoHint">O custo usa o preço do estoque (saco 50kg).</div>
      <button class="btn primary" id="btnSalvarAplicacao">Salvar aplicação</button>
      <h3>Últimas aplicações</h3>
      <ul id="listaAplicacoes" class="list"></ul>
    </section>

    <!-- Estoque -->
    <section id="sec-estoque" class="card">
      <h2>📦 Estoque</h2>
      <div class="grid-3">
        <input id="inpNomeInsumo" placeholder="Ex.: NPK"/>
        <input id="inpQtdInsumo" type="number" step="0.01" placeholder="Ex.: 1000 (kg)"/>
        <input id="inpPrecoInsumo" type="number" step="0.01" placeholder="Preço por saco 50kg (R$)"/>
      </div>
      <button class="btn primary" id="btnAddEstoque">Adicionar ao Estoque</button>

      <h3>Itens</h3>
      <table class="tabela">
        <thead><tr><th>Insumo</th><th>Qtd (kg)</th><th>Preço 50kg (R$)</th><th>Ações</th></tr></thead>
        <tbody id="tbEstoque"></tbody>
      </table>
    </section>

    <!-- Resumo (tabela + gráficos responsivos) -->
    <section id="sec-resumo" class="card">
      <h2>📊 Resumo Mensal</h2>
      <div class="grid-3">
        <select id="selMes"></select>
        <select id="selAno"></select>
        <div class="right">
          <button class="btn" id="btnCSV">Exportar CSV</button>
          <button class="btn" id="btnPDF">Exportar PDF</button>
        </div>
      </div>

      <table class="tabela" id="tblResumo">
        <thead><tr><th>Insumo</th><th>Kg aplicados</th><th>Gasto (R$)</th><th>Mês/Ano</th></tr></thead>
        <tbody id="tbodyResumo"></tbody>
        <tfoot><tr><th>Total</th><th id="totKg">0</th><th id="totR$">0,00</th><th></th></tr></tfoot>
      </table>

      <div class="charts">
        <div class="chart-card">
          <h3>Kg aplicados por insumo</h3>
          <canvas id="chartKg"></canvas>
        </div>
        <div class="chart-card">
          <h3>Gasto por insumo (R$)</h3>
          <canvas id="chartGasto"></canvas>
        </div>
      </div>
    </section>

    <!-- Histórico (backup local JSON + Google Drive) -->
    <section id="sec-historico" class="card">
      <h2>🗂️ Histórico / Backup</h2>
      <div class="grid-2">
        <button class="btn" id="btnExportJSON">Exportar backup (JSON)</button>
        <label class="file">
          <input type="file" id="fileImportJSON" accept="application/json"/>
          <span class="btn">Importar backup (JSON)</span>
        </label>
      </div>

      <h3>Backup no Google Drive (opcional)</h3>
      <div class="grid-3">
        <button class="btn" id="btnGConnect">Conectar ao Google</button>
        <button class="btn" id="btnGSalvar">Salvar no Drive</button>
        <button class="btn" id="btnGCarregar">Carregar do Drive</button>
      </div>
    </section>

    <!-- Config -->
    <section id="sec-config" class="card">
      <h2>⚙️ Configurações</h2>
      <button class="btn danger" id="btnWipe">Apagar TODOS os dados</button>
    </section>
  </main>

  <nav class="nav">
    <button data-go="sec-talhoes" class="active">🌿 Talhões</button>
    <button data-go="sec-registros">🧾 Registros</button>
    <button data-go="sec-estoque">📦 Estoque</button>
    <button data-go="sec-resumo">📊 Resumo</button>
    <button data-go="sec-historico">🗂️ Histórico</button>
    <button data-go="sec-config">⚙️ Config</button>
  </nav>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('service-worker.js'));
    }
  </script>
</body>
</html>
